(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[608],{2622:function(e,t,n){Promise.resolve().then(n.bind(n,9105))},9763:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var s=n(2265),r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let n=(0,s.forwardRef)((n,i)=>{let{color:o="currentColor",size:d=24,strokeWidth:c=2,absoluteStrokeWidth:l,className:u="",children:m,...g}=n;return(0,s.createElement)("svg",{ref:i,...r,width:d,height:d,stroke:o,strokeWidth:l?24*Number(c)/Number(d):c,className:["lucide","lucide-".concat(a(e)),u].join(" "),...g},[...t.map(e=>{let[t,n]=e;return(0,s.createElement)(t,n)}),...Array.isArray(m)?m:[m]])});return n.displayName="".concat(e),n}},5863:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(9763).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9376:function(e,t,n){"use strict";var s=n(5475);n.o(s,"useParams")&&n.d(t,{useParams:function(){return s.useParams}}),n.o(s,"usePathname")&&n.d(t,{usePathname:function(){return s.usePathname}}),n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}}),n.o(s,"useSearchParams")&&n.d(t,{useSearchParams:function(){return s.useSearchParams}})},9105:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var s=n(7437),r=n(2265),a=n(9376),i=n(5863);function o(){let e=(0,a.useRouter)(),[t,n]=(0,r.useState)([]),[o,d]=(0,r.useState)({pending:0,confirmed:0,completed:0,cancelled:0,totalRevenue:0}),[c,l]=(0,r.useState)(!0),[u,m]=(0,r.useState)(null),[g,h]=(0,r.useState)("pending");(0,r.useEffect)(()=>{p()},[]);let p=async()=>{l(!0),m(null);try{let e=await fetch("/api/bookings?vendorId=".concat("vendor_456"));if(!e.ok){let t="Failed to fetch bookings. Status: ".concat(e.status);try{let n=await e.json();"string"==typeof(null==n?void 0:n.message)&&n.message&&(t=n.message)}catch(e){console.warn("Could not parse error response body as JSON.")}throw Error(t)}let t=await e.json();if(!t||!Array.isArray(t.bookings))throw Error("Invalid data structure received from bookings API.");t.bookings.map(e=>{var t,n,s;let r=["pending","confirmed","completed","cancelled"].includes(e.status)?e.status:"pending",a=["pending","completed","failed"].includes(e.paymentStatus)?e.paymentStatus:"pending";return{id:String(null!==(t=e.id)&&void 0!==t?t:"unknown-".concat(Math.random())),packageId:String(null!==(n=e.packageId)&&void 0!==n?n:""),packageName:String(e.packageName||"Unknown Package"),userId:String(null!==(s=e.userId)&&void 0!==s?s:""),userName:String(e.userName||"Unknown User"),userEmail:String(e.userEmail||""),userPhone:String(e.userPhone||""),startDate:String(e.startDate||""),endDate:String(e.endDate||""),guests:Number(e.guests)||0,amount:Number(e.amount)||0,commission:Number(e.commission)||0,netAmount:Number(e.netAmount)||0,status:r,paymentStatus:a,createdAt:String(e.createdAt||new Date().toISOString())}}),console.log("Using MOCK data instead of fetched data");let s=[];n(s);let r=s.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,"completed"===t.paymentStatus&&(e.totalRevenue+=Number(t.netAmount)||0),e),{pending:0,confirmed:0,completed:0,cancelled:0,totalRevenue:0});d(r)}catch(e){console.error("Error fetching bookings:",e),m(e instanceof Error?e.message:"Failed to load bookings. Please try again later.")}finally{l(!1)}},x=t=>{e.push("/vendor/bookings/".concat(t))},b=async(e,t)=>{m(null);try{let s;await new Promise(e=>setTimeout(e,500)),n(n=>n.map(n=>n.id===e?(s=n.status,{...n,status:t}):n)),s&&d(e=>({...e,[t]:(e[t]||0)+1,[s]:(e[s]||1)-1})),alert("Booking status updated to ".concat(t))}catch(t){let e=t instanceof Error?t.message:"Failed to update booking status.";m(e),alert(e)}},f=e=>(0,s.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat({confirmed:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",completed:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"),children:[" ",e.charAt(0).toUpperCase()+e.slice(1)," "]}),j=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(e){return"Invalid Date"}},v=t.filter(e=>e.status===g);return(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Manage Bookings"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[" ",(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[" ",(0,s.jsx)("p",{children:"Pending"})," ",(0,s.jsx)("p",{children:o.pending})," "]})," ",(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[" ",(0,s.jsx)("p",{children:"Confirmed"})," ",(0,s.jsx)("p",{children:o.confirmed})," "]})," ",(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[" ",(0,s.jsx)("p",{children:"Completed"})," ",(0,s.jsx)("p",{children:o.completed})," "]})," ",(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[" ",(0,s.jsx)("p",{children:"Cancelled"})," ",(0,s.jsx)("p",{children:o.cancelled})," "]})," ",(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[" ",(0,s.jsx)("p",{children:"Total Revenue"})," ",(0,s.jsxs)("p",{children:["₹",o.totalRevenue.toLocaleString()]})," "]})," "]}),(0,s.jsxs)("div",{className:"mb-6",children:[" ",(0,s.jsxs)("div",{className:"border-b border-gray-200",children:[" ",(0,s.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[" ",["pending","confirmed","completed","cancelled"].map(e=>(0,s.jsxs)("button",{onClick:()=>h(e),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat(g===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[" ",e.charAt(0).toUpperCase()+e.slice(1)," (",o[e],") "]},e))," "]})," "]})," "]}),c?(0,s.jsxs)("div",{className:"text-center py-10",children:[" ",(0,s.jsx)(i.Z,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto"})," ",(0,s.jsx)("p",{children:"Loading..."})," "]}):u?(0,s.jsxs)("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:[" ",(0,s.jsx)("p",{children:u})," "]}):(0,s.jsxs)("div",{children:[" ",0===v.length?(0,s.jsxs)("div",{className:"text-center py-10 bg-gray-50 rounded-lg",children:[" ",(0,s.jsxs)("p",{children:["No ",g," bookings."]})," "]}):(0,s.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[" ",(0,s.jsxs)("ul",{className:"divide-y divide-gray-200",children:[" ",v.map(e=>(0,s.jsxs)("li",{children:[" ",(0,s.jsxs)("div",{className:"px-4 py-4 sm:px-6",children:[" "," ",(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[" ",(0,s.jsx)("p",{children:e.packageName})," ",f(e.status)," "]})," ",(0,s.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:[" ",(0,s.jsxs)("p",{children:[e.userName," • ",e.userPhone]})," ",(0,s.jsxs)("p",{children:[j(e.startDate)," - ",j(e.endDate)]})," ",(0,s.jsxs)("p",{children:["₹",e.amount.toLocaleString()," (Net: ₹",e.netAmount.toLocaleString(),")"]})," ",(0,s.jsxs)("p",{children:["Booked: ",j(e.createdAt)]})," "]})," ",(0,s.jsxs)("div",{className:"mt-4 flex justify-end space-x-3 text-sm",children:[" ",(0,s.jsx)("button",{onClick:()=>x(e.id),children:"View"})," ","pending"===g&&(0,s.jsx)("button",{onClick:()=>b(e.id,"confirmed"),children:"Confirm"})," ","confirmed"===g&&(0,s.jsx)("button",{onClick:()=>b(e.id,"completed"),children:"Complete"})," ",("pending"===g||"confirmed"===g)&&(0,s.jsx)("button",{onClick:()=>b(e.id,"cancelled"),children:"Cancel"})," "]})," "]})," "]},e.id))," "]})," "]})," "]})]})}}},function(e){e.O(0,[971,30,744],function(){return e(e.s=2622)}),_N_E=e.O()}]);