(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{154:function(e,a,t){Promise.resolve().then(t.bind(t,7017))},7017:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return m},runtime:function(){return d}});var n=t(7437),s=t(2265),o=t(9376),r=t(8667),i=t(5863),l=t(257);function c(e){let{amount:a,bookingDetails:t,onSuccess:c,onFailure:d}=e,[m,u]=(0,s.useState)(!1),[h,x]=(0,s.useState)(!1),[y,g]=(0,s.useState)(null);(0,o.useRouter)();let p=async()=>{u(!0),g(null);try{let e=await fetch("/api/payment/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:a,currency:"INR",receipt:"booking_".concat((null==t?void 0:t.id)||Date.now())})}),n=await e.json();if(!e.ok){let a=(null==n?void 0:n.message)||(null==n?void 0:n.error)||"Failed order creation. Status: ".concat(e.status);throw Error(a)}if(!n.orderId)throw Error("Order ID missing in response.");return n.orderId}catch(e){return console.error("Error creating Razorpay order:",e),g(e instanceof Error?e.message:"Could not initiate payment."),d&&d(e),null}finally{u(!1)}},f=async()=>{if(g(null),!h){g("Payment gateway loading...");return}if(a<=0){g("Invalid amount.");return}try{let e=await p();if(!e)return;let n={key:l.env.NEXT_PUBLIC_RAZORPAY_KEY_ID||"",amount:Math.round(100*a),currency:"INR",name:"Reach Andaman",description:"Booking ID: ".concat((null==t?void 0:t.id)||"N/A"),order_id:e,handler:async function(a){u(!0),g(null),console.log("Razorpay Success Response:",a);try{let n=await fetch("/api/payment/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderCreationId:e,razorpayPaymentId:a.razorpay_payment_id,razorpayOrderId:a.razorpay_order_id,razorpaySignature:a.razorpay_signature,bookingDetails:t})}),s=await n.json();if(console.log("Verification Result:",s),s.isOk)console.log("Payment Verified Successfully."),c?c({razorpay:a,verification:s}):alert("Payment successful!");else{console.error("Payment Verification Failed:",s.message);let e="Payment verification failed: ".concat(s.message||"Unknown reason");g(e),d?d({message:e,details:s}):alert(e)}}catch(a){console.error("Error during payment verification API call:",a);let e=a instanceof Error?a.message:"Failed to verify payment.";g("Verification Error: ".concat(e)),d&&d(a)}finally{u(!1)}},prefill:{name:(null==t?void 0:t.customerName)||"",email:(null==t?void 0:t.customerEmail)||"",contact:(null==t?void 0:t.customerPhone)||""},notes:{booking_id:(null==t?void 0:t.id)||"N/A",package_name:(null==t?void 0:t.packageName)||"N/A"},theme:{color:"#2563EB"}};if(!window.Razorpay)throw Error("Razorpay SDK not loaded.");let s=new window.Razorpay(n);s.on("payment.failed",function(e){var a,t;console.error("Razorpay Payment Failed Response:",e.error);let n=(null===(a=e.error)||void 0===a?void 0:a.description)||(null===(t=e.error)||void 0===t?void 0:t.reason)||"Payment failed.";g("Payment Failed: ".concat(n)),d&&d(e.error)}),s.open()}catch(e){console.error("Error initiating payment:",e),g(e instanceof Error?e.message:"Could not initiate payment."),d&&!m&&d(e)}};return(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)(r.default,{id:"razorpay-checkout-js",src:"https://checkout.razorpay.com/v1/checkout.js",onLoad:()=>{console.log("Razorpay SDK loaded."),x(!0)},onError:e=>{g("Failed to load payment gateway.")}}),y&&(0,n.jsxs)("div",{className:"p-3 bg-red-100 text-red-700 rounded-md text-sm border border-red-200",children:[" ",y," "]}),(0,n.jsx)("button",{onClick:f,disabled:m||!h||a<=0,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-4 rounded-md transition duration-200 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center",children:m?(0,n.jsxs)(n.Fragment,{children:[" ",(0,n.jsx)(i.Z,{className:"animate-spin h-4 w-4 mr-2"})," Processing... "]}):"Pay ₹".concat(a.toLocaleString("en-IN"))}),!h&&!y&&(0,n.jsx)("p",{className:"text-xs text-center text-gray-500 mt-1",children:"Initializing..."})]})}let d="edge";function m(e){var a,t,r,i,l;let{params:d}=e,m=(0,o.useRouter)(),[u,h]=(0,s.useState)(!0),[x,y]=(0,s.useState)({id:d.id,amount:0,customerName:"",customerEmail:"",customerPhone:"",bookingData:null}),[g,p]=(0,s.useState)("idle"),[f,b]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{h(!0);try{let e={id:d.id,packageName:"Havelock Island Adventure",startDate:"2025-05-15",endDate:"2025-05-20",guests:2,amount:25e3,customerName:"Rahul Sharma",customerEmail:"rahul.s@example.com",customerPhone:"9876543210"};y({id:d.id,amount:e.amount,customerName:e.customerName,customerEmail:e.customerEmail,customerPhone:e.customerPhone,bookingData:e})}catch(e){console.error("Error fetching booking details:",e),y(e=>({...e,bookingData:null}))}finally{h(!1)}})()},[d.id]),u)?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-700 mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading booking details..."})]})}):x.bookingData||u?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,n.jsx)("div",{className:"container mx-auto px-4",children:(0,n.jsxs)("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow-md overflow-hidden",children:[(0,n.jsx)("div",{className:"px-6 py-4 bg-blue-600 text-white",children:(0,n.jsx)("h1",{className:"text-xl font-bold",children:"Complete Your Payment"})}),(0,n.jsxs)("div",{className:"p-6",children:["idle"===g&&x.bookingData&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Booking Summary"}),(0,n.jsxs)("div",{className:"border-t border-b py-4",children:[(0,n.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Booking ID"}),(0,n.jsx)("span",{className:"font-medium",children:x.id})]}),(0,n.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Package"}),(0,n.jsx)("span",{className:"font-medium",children:null===(a=x.bookingData)||void 0===a?void 0:a.packageName})]}),(0,n.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Dates"}),(0,n.jsxs)("span",{className:"font-medium",children:[null===(t=x.bookingData)||void 0===t?void 0:t.startDate," to ",null===(r=x.bookingData)||void 0===r?void 0:r.endDate]})]}),(0,n.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Guests"}),(0,n.jsx)("span",{className:"font-medium",children:null===(i=x.bookingData)||void 0===i?void 0:i.guests})]}),(0,n.jsxs)("div",{className:"flex justify-between pt-4 border-t",children:[(0,n.jsx)("span",{className:"text-gray-800 font-semibold",children:"Total Amount"}),(0,n.jsxs)("span",{className:"text-xl font-bold",children:["₹",x.amount.toLocaleString("en-IN")]})]})]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Payment Method"}),(0,n.jsx)("div",{className:"bg-gray-50 p-4 rounded-md mb-4",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsxs)("div",{className:"h-8 w-auto mr-3",children:[" ",(0,n.jsx)("img",{src:"/razorpay-logo.png",alt:"Razorpay",className:"h-full w-auto object-contain"})," "]}),(0,n.jsxs)("div",{children:[" ",(0,n.jsx)("p",{className:"font-medium",children:"Razorpay"})," ",(0,n.jsx)("p",{className:"text-sm text-gray-500",children:"Secure payment gateway"})," "]})]})})]}),(0,n.jsx)(c,{amount:x.amount,bookingDetails:{id:x.id,customerName:x.customerName,customerEmail:x.customerEmail,customerPhone:x.customerPhone,type:"Package",packageName:null===(l=x.bookingData)||void 0===l?void 0:l.packageName},onSuccess:e=>{console.log("Payment Successful:",e),p("success"),b(e),setTimeout(()=>{m.push("/bookings/confirmation/".concat(d.id,"?paymentId=").concat(e.razorpay_payment_id))},2e3)},onFailure:e=>{console.error("Payment Failed:",e),p("failed"),b(e)}}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-4 text-center",children:"By proceeding with the payment, you agree to our terms and conditions."})]}),"success"===g&&(0,n.jsxs)("div",{className:"text-center py-8",children:[" "," ",(0,n.jsx)("h2",{className:"text-2xl font-bold text-green-600 mb-2",children:"Payment Successful!"})," "," ",(0,n.jsx)("p",{className:"text-gray-600",children:"Redirecting to confirmation page..."})," "]}),"failed"===g&&(0,n.jsxs)("div",{className:"text-center py-8",children:[" "," ",(0,n.jsx)("h2",{className:"text-2xl font-bold text-red-600 mb-2",children:"Payment Failed"})," "," ",(0,n.jsx)("button",{onClick:()=>p("idle"),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md",children:" Try Again "})," "]})]})]})})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center p-6 bg-white rounded shadow-md",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-red-600 mb-4",children:"Error Loading Booking"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"Could not load the details for this booking. Please try again later or contact support."}),(0,n.jsx)("button",{onClick:()=>m.back(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Go Back"})]})})}}},function(e){e.O(0,[605,971,30,744],function(){return e(e.s=154)}),_N_E=e.O()}]);